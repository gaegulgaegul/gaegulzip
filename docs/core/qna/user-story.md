# 사용자 스토리: QnA (질문과 답변)

## 개요

사용자가 제품 사용 중 궁금한 점을 질문하면 자동으로 GitHub Issues로 등록되어 운영팀이 효율적으로 관리할 수 있는 기능입니다. 모든 제품에서 공통으로 사용하며, 앱 코드별로 서로 다른 GitHub 레포지토리에 연동됩니다.

**비즈니스 가치**: 사용자 피드백 수집 채널을 단일화하고, GitHub의 이슈 트래킹 기능을 활용하여 빠른 대응 및 히스토리 관리를 가능하게 합니다.

---

## 사용자 페르소나

### 1. 일반 사용자 (Primary)
- **특징**: 제품을 사용하는 누구나, 로그인 여부 무관
- **니즈**: 궁금한 점을 간단하게 질문하고, 빠른 답변을 받고 싶음
- **행동**: 앱 내 QnA 화면에서 질문 작성 및 제출

### 2. 운영팀/관리자 (Secondary)
- **특징**: 제품을 관리하는 팀원, GitHub 레포지토리 접근 권한 보유
- **니즈**: 사용자 질문을 효율적으로 추적하고, 답변 이력을 체계적으로 관리
- **행동**: GitHub Issues에서 질문 확인, 라벨링, 답변 작성, 이슈 종료

---

## 사용자 스토리

### US-1: 질문 작성 및 제출
- **As a** 제품 사용자
- **I want to** 앱 내에서 간편하게 질문을 작성하고 제출할 수 있다
- **So that** 제품 사용 중 궁금한 점을 즉시 해결할 수 있다

### US-2: 질문 자동 등록
- **As a** 제품 사용자
- **I want to** 내가 제출한 질문이 자동으로 GitHub Issue로 등록된다
- **So that** 운영팀이 내 질문을 놓치지 않고 확인할 수 있다

### US-3: 앱별 레포지토리 분리
- **As a** 운영팀
- **I want to** 각 제품(앱)의 질문이 서로 다른 GitHub 레포지토리에 등록된다
- **So that** 제품별 질문을 독립적으로 관리하고 우선순위를 설정할 수 있다

### US-4: 질문 메타데이터 포함
- **As a** 운영팀
- **I want to** GitHub Issue에 질문자 정보(사용자 ID, 앱 코드, 작성 시각 등) 메타데이터가 포함된다
- **So that** 질문 맥락을 이해하고 빠르게 대응할 수 있다

### US-5: 제출 결과 확인
- **As a** 제품 사용자
- **I want to** 질문 제출 후 성공 또는 실패 여부를 즉시 알 수 있다
- **So that** 내 질문이 제대로 전달되었는지 확인할 수 있다

### US-6: 익명 질문 지원 (선택적)
- **As a** 제품 사용자 (비로그인)
- **I want to** 로그인하지 않아도 질문을 제출할 수 있다
- **So that** 계정이 없거나 로그인을 원하지 않을 때도 문의할 수 있다

---

## 사용자 시나리오

### 시나리오 1: 로그인 사용자의 질문 제출 (정상 플로우)
1. 사용자가 앱 내 "문의하기" 또는 "질문하기" 메뉴에 접근한다
2. 시스템이 질문 작성 화면을 표시한다
3. 사용자가 질문 제목과 내용을 입력하고 제출 버튼을 누른다
4. 시스템이 질문을 서버로 전송한다
5. 서버가 해당 앱 코드에 매핑된 GitHub 레포지토리에 Issue를 생성한다
6. 시스템이 "질문이 성공적으로 등록되었습니다" 메시지를 표시한다
7. **결과**: GitHub Issues에 새로운 이슈가 생성되고, 사용자는 확인 메시지를 받는다

### 시나리오 2: 비로그인 사용자의 질문 제출
1. 비로그인 사용자가 "문의하기" 메뉴에 접근한다
2. 시스템이 질문 작성 화면을 표시한다
3. 사용자가 질문 제목, 내용을 입력하고 제출한다
4. 시스템이 질문을 서버로 전송한다 (사용자 ID는 null 또는 "익명")
5. 서버가 GitHub Issue를 생성하며, 메타데이터에 "익명 사용자" 표시
6. 시스템이 성공 메시지를 표시한다
7. **결과**: 익명 질문도 GitHub Issues에 등록되어 관리된다

### 시나리오 3: 질문 제출 실패 (네트워크 오류)
1. 사용자가 질문을 작성하고 제출 버튼을 누른다
2. 시스템이 서버로 전송을 시도하지만 네트워크 연결이 끊긴 상태다
3. 시스템이 "네트워크 연결을 확인해주세요" 에러 메시지를 표시한다
4. 사용자가 네트워크를 확인하고 다시 제출 버튼을 누른다
5. 시스템이 질문을 성공적으로 전송한다
6. **결과**: 일시적 네트워크 오류에도 재시도로 질문 등록 가능

### 시나리오 4: GitHub API 장애 시
1. 사용자가 질문을 제출한다
2. 서버가 GitHub API를 호출하지만 GitHub 서비스가 일시적으로 장애 상태다
3. 서버가 에러를 감지하고 사용자에게 "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요" 메시지를 반환한다
4. **결과**: 사용자는 에러를 인지하고, 서버 로그에 GitHub API 장애가 기록된다

### 시나리오 5: 운영팀의 질문 확인 및 답변
1. 운영팀 멤버가 GitHub 레포지토리의 Issues 탭을 연다
2. 자동 생성된 QnA 이슈 목록을 확인한다 (라벨로 필터링 가능)
3. 이슈를 클릭하여 질문 내용과 메타데이터를 확인한다
4. 코멘트로 답변을 작성하거나, 관련 팀원에게 assignee로 지정한다
5. 답변이 완료되면 이슈를 종료한다
6. **결과**: 질문이 체계적으로 관리되고, 이력이 GitHub에 보존된다

---

## 인수 조건 (Acceptance Criteria)

### 기본 기능
- [ ] 사용자가 질문 제목과 내용을 입력할 수 있다
- [ ] 제출 버튼을 누르면 서버로 질문이 전송된다
- [ ] 서버가 앱 코드에 따라 올바른 GitHub 레포지토리를 선택한다
- [ ] GitHub Issues API를 통해 새로운 이슈가 생성된다
- [ ] 생성된 이슈는 자동으로 특정 라벨(예: "qna", "user-question")이 적용된다

### 메타데이터 포함
- [ ] GitHub Issue의 본문에 다음 정보가 포함된다:
  - 질문자 사용자 ID (로그인 사용자인 경우)
  - 앱 코드 (예: "wowa")
  - 질문 작성 시각 (ISO 8601 형식)
  - 익명 사용자 여부 표시
- [ ] GitHub Issue의 제목은 사용자가 입력한 제목 또는 "QnA: [제목]" 형식으로 표시된다

### 사용자 피드백
- [ ] 질문 제출 성공 시 성공 메시지가 표시된다
- [ ] 질문 제출 실패 시 에러 메시지가 표시된다
- [ ] 네트워크 오류, GitHub API 오류를 구분하여 표시할 수 있다

### 인증 처리
- [ ] 로그인 사용자는 사용자 ID가 메타데이터에 포함된다
- [ ] 비로그인 사용자도 질문을 제출할 수 있다 (익명 처리)

### 앱별 분리
- [ ] 각 앱 코드(예: wowa, app-b)마다 서로 다른 GitHub 레포지토리에 이슈가 생성된다
- [ ] 앱 코드와 레포지토리 매핑은 설정으로 관리된다 (하드코딩 금지)

---

## 엣지 케이스

### 입력 검증
- **빈 제목 또는 본문**: "제목과 내용을 입력해주세요" 에러 메시지 표시, 제출 불가
- **과도하게 긴 제목/본문**: 제목은 256자, 본문은 65536자 이내로 제한 (GitHub Issues API 제한)
- **제어 문자 포함**: 제어 문자는 자동으로 제거 (탭, 개행은 유지)
- **Markdown 주입 시도**: 사용자 입력은 이스케이프 처리하여 의도하지 않은 Markdown 렌더링 방지

### 네트워크 및 외부 API
- **네트워크 타임아웃**: "네트워크 연결을 확인해주세요" 메시지 표시
- **GitHub API Rate Limit 초과**: "일시적으로 질문 등록이 제한되었습니다. 잠시 후 다시 시도해주세요" 메시지
- **GitHub API 장애 (5xx)**: "서비스 오류가 발생했습니다. 잠시 후 다시 시도해주세요" 메시지
- **레포지토리 접근 권한 부족 (403/404)**: 서버 로그에 에러 기록, 사용자에게는 "일시적인 오류" 메시지 (보안상 상세 노출 금지)

### 앱 설정
- **앱 코드에 매핑된 GitHub 레포지토리 없음**: "서비스 설정 오류" 에러 반환, 서버 로그에 경고 기록
- **GitHub 인증 정보 누락**: "서비스 설정 오류" 에러 반환, 서버 로그에 경고 기록

### 동시성
- **같은 사용자가 짧은 시간에 여러 질문 제출**: 각 질문은 독립적인 Issue로 생성됨 (중복 검사 없음)
- **동시에 다수 사용자가 질문 제출**: GitHub API Rate Limit 내에서 순차 처리 또는 큐 기반 처리

---

## 비즈니스 규칙

### BR-1: 앱별 레포지토리 매핑
- 각 앱 코드(예: wowa)는 하나의 GitHub 레포지토리(owner/repo)에 매핑됩니다
- 매핑 정보는 데이터베이스 또는 설정 파일에 저장되며, 런타임에 변경 가능해야 합니다
- 매핑되지 않은 앱 코드로 질문 제출 시 에러를 반환합니다

### BR-2: 익명 질문 허용
- 로그인하지 않은 사용자도 질문을 제출할 수 있습니다
- 익명 사용자의 경우 GitHub Issue 메타데이터에 "익명 사용자" 또는 "비회원"으로 표시합니다
- 사용자 ID 필드는 null 또는 특별한 값(예: 0)으로 처리합니다

### BR-3: GitHub Issue 자동 라벨링
- 자동 생성된 QnA는 기본 라벨(예: "qna", "user-question")이 적용됩니다
- 앱별로 추가 라벨(예: "wowa", "app-b")을 설정할 수 있습니다
- 라벨 목록은 앱 설정에서 관리됩니다

### BR-4: 메타데이터 포함 규칙
- 모든 QnA Issue는 다음 정보를 본문에 포함합니다:
  - 질문 내용 (사용자 입력)
  - 질문자 정보 (사용자 ID, 익명 여부)
  - 앱 코드
  - 작성 시각 (UTC, ISO 8601 형식)
  - 추가 컨텍스트 (예: 앱 버전, 디바이스 정보 — 향후 확장)

### BR-5: 입력 검증
- 제목: 필수, 1~256자
- 본문: 필수, 1~65536자
- 제목 및 본문에서 제어 문자 제거 (탭, 개행은 유지)

### BR-6: 질문 수정/삭제 불가
- Phase 1에서는 질문 제출 후 수정 및 삭제 기능을 제공하지 않습니다
- 사용자는 새로운 질문을 제출할 수 있습니다
- 운영팀은 GitHub에서 Issue를 직접 수정/삭제할 수 있습니다

---

## 필요한 데이터

### 입력 데이터 (사용자 → 서버)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| appCode | string | ✅ | 앱 식별 코드 (예: "wowa") |
| title | string | ✅ | 질문 제목 (1~256자) |
| body | string | ✅ | 질문 내용 (1~65536자) |
| userId | number/null | ❌ | 질문자 사용자 ID (로그인 시), 비로그인 시 null |

### 출력 데이터 (서버 → 사용자)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| success | boolean | ✅ | 성공 여부 |
| message | string | ✅ | 결과 메시지 ("질문이 등록되었습니다" 등) |
| issueUrl | string | ❌ | 생성된 GitHub Issue URL (성공 시, 선택적) |
| issueNumber | number | ❌ | 생성된 GitHub Issue 번호 (성공 시, 선택적) |

### 설정 데이터 (앱별)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| appCode | string | ✅ | 앱 식별 코드 |
| githubRepoOwner | string | ✅ | GitHub 레포지토리 소유자 (조직/사용자명) |
| githubRepoName | string | ✅ | GitHub 레포지토리 이름 |
| githubLabels | string[] | ❌ | 자동 적용할 라벨 목록 (기본: ["qna"]) |
| githubAssignees | string[] | ❌ | 자동 지정할 assignee 목록 (선택적) |

### 내부 처리 데이터 (서버)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| githubAppId | string | ✅ | GitHub App ID (인증용) |
| githubPrivateKey | string | ✅ | GitHub App Private Key (인증용) |
| githubInstallationId | number | ✅ | GitHub App Installation ID (인증용) |
| githubAccessToken | string | ✅ | GitHub API 호출용 액세스 토큰 (동적 생성) |

---

## 비기능 요구사항

### 성능
- **응답 시간**: GitHub API 호출 포함, 사용자에게 5초 이내 응답 (정상 상황)
- **Rate Limit 대응**: GitHub API Rate Limit (시간당 5,000건, 분당 80건 콘텐츠 생성)을 고려한 처리
  - 동시 다발 요청 시 큐 기반 순차 처리 고려 (향후)
  - Rate Limit 초과 시 사용자에게 재시도 안내

### 보안
- **입력 검증**: 모든 사용자 입력(제목, 본문)에 대해 검증 수행
  - XSS/Markdown 주입 방지: 사용자 입력 이스케이프 처리
  - 길이 제한 강제 (제목 256자, 본문 65536자)
- **GitHub 인증 정보 보호**: Private Key, Access Token은 환경 변수 또는 Secret Manager에 저장, 로그에 노출 금지
- **익명 사용자 남용 방지**: Rate Limiting 또는 CAPTCHA 고려 (향후)

### 가용성
- **GitHub API 장애 대응**: GitHub API 장애 시 사용자에게 명확한 에러 메시지, 서버 로그에 상세 기록
- **재시도 로직**: 일시적 네트워크 오류에 대해 자동 재시도 (최대 3회, Exponential Backoff)
- **Graceful Degradation**: GitHub API 장애 시에도 서버 자체는 정상 동작 유지

### 확장성
- **멀티 테넌트**: 여러 앱 코드가 서로 다른 GitHub 레포지토리에 독립적으로 질문 등록
- **앱별 설정**: 레포지토리, 라벨, assignee 등 앱별 커스터마이징 가능

### 모니터링 및 로깅
- **운영 로그**: 질문 등록 성공/실패, GitHub API 에러, Rate Limit 초과 등 주요 이벤트 로깅
- **메트릭**: 질문 등록 수, 성공률, 평균 응답 시간, GitHub API 호출 수 등 모니터링 가능해야 함
- **민감 정보 제외**: 로그에 사용자 질문 내용, GitHub 토큰 등 민감 정보 노출 금지

### 에러 처리
- **사용자 피드백**: 에러 발생 시 사용자가 이해하기 쉬운 메시지 제공
  - 네트워크 오류: "네트워크 연결을 확인해주세요"
  - 서버 오류: "일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요"
  - 입력 오류: "제목과 내용을 확인해주세요"
- **로그 기록**: 모든 에러는 서버 로그에 상세 기록 (에러 타입, 스택 트레이스, 컨텍스트)

---

## 스코프

### Phase 1 (MVP, 현재)
- [x] 질문 제출 기능 (제목 + 본문)
- [x] GitHub Issues 자동 생성
- [x] 앱별 레포지토리 분리
- [x] 메타데이터 포함 (사용자 ID, 앱 코드, 작성 시각)
- [x] 익명 질문 지원
- [x] 기본 에러 처리 (네트워크, GitHub API)
- [x] 제출 성공/실패 피드백

### Phase 2 (향후)
- [ ] 질문 목록 조회 (사용자가 자신의 질문 확인)
- [ ] 질문 상태 조회 (GitHub Issue 상태와 동기화)
- [ ] 운영팀 답변 알림 (GitHub Issue 코멘트 → 푸시 알림/이메일)
- [ ] 첨부파일 지원 (이미지, 파일)
- [ ] 질문 카테고리/태그 선택
- [ ] FAQ 연동 (자주 묻는 질문 자동 제안)
- [ ] 질문 수정/삭제 기능
- [ ] 다국어 지원 (제목/본문 번역)

### Out of Scope (Phase 1에서 제외)
- ❌ 실시간 채팅 기능
- ❌ 질문 투표/좋아요 기능
- ❌ 사용자 간 질문 공유
- ❌ GitHub 외 다른 이슈 트래커 연동 (Jira, Linear 등)
- ❌ 질문 통계 대시보드

---

## 참고 자료

- GitHub Issues REST API: https://docs.github.com/en/rest/issues/issues
- GitHub App 인증: https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app
- 기술 리서치: [`docs/wowa/research/github-issues-api.md`](../../wowa/research/github-issues-api.md)
