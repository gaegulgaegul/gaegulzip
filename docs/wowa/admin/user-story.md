# 사용자 스토리: 어드민 웹 애플리케이션

## 개요

wowa 앱을 운영하기 위한 어드민 웹 애플리케이션입니다. 개발자 1인이 사용자와 콘텐츠를 효율적으로 관리할 수 있도록 직관적인 관리 인터페이스를 제공합니다.

## 사용자 스토리

### US-1: 어드민 로그인

- **As a** 개발자
- **I want to** 안전하게 어드민에 로그인하기
- **So that** 권한이 있는 사용자만 관리 기능에 접근할 수 있다

### US-2: 사용자 목록 조회

- **As a** 개발자
- **I want to** 가입한 사용자 목록을 확인하기
- **So that** 전체 사용자 현황을 파악하고 특정 사용자를 빠르게 찾을 수 있다

### US-3: 사용자 상세 정보 조회

- **As a** 개발자
- **I want to** 개별 사용자의 상세 정보를 확인하기
- **So that** 사용자 문의 대응 및 계정 문제 해결에 활용할 수 있다

### US-4: 사용자 관리

- **As a** 개발자
- **I want to** 사용자 계정을 비활성화하거나 정보를 수정하기
- **So that** 악의적인 사용자를 차단하거나 사용자 요청에 따른 정보 수정을 할 수 있다

### US-5: 푸시 알림 발송

- **As a** 개발자
- **I want to** 특정 사용자 또는 전체 사용자에게 푸시 알림을 발송하기
- **So that** 공지사항이나 중요 정보를 실시간으로 전달할 수 있다

### US-6: 푸시 알림 발송 이력 조회

- **As a** 개발자
- **I want to** 발송한 푸시 알림 이력을 확인하기
- **So that** 어떤 알림이 언제 누구에게 발송되었는지 추적할 수 있다

### US-7: 대시보드 통계

- **As a** 개발자
- **I want to** 주요 지표를 한눈에 확인하기
- **So that** 앱 운영 상태를 빠르게 파악하고 의사결정에 활용할 수 있다

---

## 사용자 시나리오

### 시나리오 1: 어드민 로그인 및 대시보드 확인

1. 개발자가 어드민 웹 URL에 접속
2. 시스템이 로그인 페이지를 표시
3. 개발자가 인증 정보를 입력하고 로그인
4. 시스템이 인증을 확인하고 대시보드로 이동
5. 대시보드에 주요 지표(총 사용자 수, 오늘 신규 가입, 최근 푸시 발송 수) 표시
6. 결과: 개발자가 앱 운영 현황을 한눈에 파악

### 시나리오 2: 특정 사용자 문제 해결

1. 사용자가 카카오톡으로 "로그인이 안 돼요" 문의
2. 개발자가 어드민 사용자 목록 페이지 접속
3. 개발자가 검색창에 사용자 이메일 또는 닉네임 입력
4. 시스템이 검색 결과를 표시
5. 개발자가 해당 사용자 행을 클릭
6. 시스템이 사용자 상세 페이지를 표시 (가입일, 마지막 로그인, 인증 제공자, 활성 토큰 수)
7. 개발자가 "모든 토큰 무효화" 버튼 클릭
8. 시스템이 확인 대화창을 표시
9. 개발자가 확인
10. 시스템이 해당 사용자의 모든 Refresh Token을 무효화
11. 시스템이 성공 메시지 표시
12. 결과: 사용자가 재로그인하여 문제 해결

### 시나리오 3: 전체 사용자 대상 공지 발송

1. 개발자가 푸시 알림 발송 페이지 접속
2. 시스템이 발송 폼을 표시 (제목, 내용, 대상 선택)
3. 개발자가 제목에 "긴급 점검 공지" 입력
4. 개발자가 내용에 "오늘 23:00 ~ 01:00 서버 점검 예정입니다" 입력
5. 개발자가 대상을 "전체 사용자" 선택
6. 개발자가 "발송" 버튼 클릭
7. 시스템이 확인 대화창 표시 ("123명에게 발송됩니다. 계속하시겠습니까?")
8. 개발자가 확인
9. 시스템이 백그라운드로 알림 발송 시작
10. 시스템이 "발송 중... 진행률: 50/123" 표시
11. 발송 완료 시 성공 메시지와 결과 통계 표시 (성공 120건, 실패 3건)
12. 결과: 전체 사용자가 공지를 수신

### 시나리오 4: 악의적인 사용자 차단

1. 개발자가 신고된 사용자의 상세 페이지 접속
2. 시스템이 사용자 정보와 관리 옵션 표시
3. 개발자가 "계정 비활성화" 버튼 클릭
4. 시스템이 비활성화 이유 입력 대화창 표시
5. 개발자가 "스팸 신고 다수" 입력
6. 시스템이 사용자 계정을 비활성화 처리
7. 시스템이 해당 사용자의 모든 활성 토큰 무효화
8. 시스템이 성공 메시지 표시
9. 결과: 비활성화된 사용자는 로그인 불가

### 시나리오 5: 푸시 알림 발송 이력 조회

1. 개발자가 푸시 알림 이력 페이지 접속
2. 시스템이 최근 발송 이력을 시간 역순으로 표시
3. 각 이력에 발송 시간, 제목, 대상 수, 성공/실패 건수 표시
4. 개발자가 특정 이력 행 클릭
5. 시스템이 상세 정보 표시 (전체 내용, 개별 수신 상태, 실패 이유)
6. 결과: 개발자가 발송 결과를 확인하고 실패 원인 파악

---

## 인수 조건 (Acceptance Criteria)

### 인증 및 권한
- [ ] 인증되지 않은 사용자는 어드민 페이지에 접근할 수 없다
- [ ] 로그인 실패 시 명확한 에러 메시지를 표시한다
- [ ] 세션이 만료되면 자동으로 로그인 페이지로 이동한다
- [ ] 로그아웃 시 모든 인증 정보가 삭제된다

### 사용자 관리
- [ ] 사용자 목록을 페이지네이션으로 조회할 수 있다
- [ ] 이메일, 닉네임, 제공자로 사용자를 검색할 수 있다
- [ ] 사용자 목록을 가입일, 마지막 로그인 기준으로 정렬할 수 있다
- [ ] 사용자 상세 페이지에서 기본 정보, 가입일, 마지막 로그인, 활성 토큰 수를 확인할 수 있다
- [ ] 사용자의 모든 Refresh Token을 무효화할 수 있다
- [ ] 사용자 계정을 비활성화할 수 있다
- [ ] 비활성화된 사용자는 목록에서 구분되어 표시된다

### 푸시 알림
- [ ] 푸시 알림 제목과 내용을 입력할 수 있다
- [ ] 발송 대상을 선택할 수 있다 (전체 / 특정 사용자)
- [ ] 발송 전 대상 사용자 수를 미리보기로 확인할 수 있다
- [ ] 발송 확인 대화창에서 최종 확인 후 발송된다
- [ ] 발송 진행률을 실시간으로 확인할 수 있다
- [ ] 발송 완료 시 성공/실패 통계를 표시한다
- [ ] 푸시 알림 발송 이력을 시간 역순으로 조회할 수 있다
- [ ] 이력에서 개별 발송 상세 내역을 확인할 수 있다

### 대시보드
- [ ] 총 사용자 수를 표시한다
- [ ] 오늘 신규 가입 수를 표시한다
- [ ] 최근 7일간 일별 가입 추이를 그래프로 표시한다
- [ ] 제공자별 사용자 비율을 표시한다
- [ ] 최근 푸시 발송 건수를 표시한다
- [ ] 활성 사용자 수(최근 30일 로그인)를 표시한다

---

## 엣지 케이스

### 인증
- **세션 만료 중 작업**: 세션 만료 시 현재 작업 중인 데이터를 잃지 않고 로그인 후 복귀할 수 있다
- **동시 로그인**: 여러 브라우저/탭에서 동시 로그인 시 모두 정상 작동한다

### 사용자 관리
- **존재하지 않는 사용자**: 사용자 상세 페이지 접근 시 해당 사용자가 없으면 "사용자를 찾을 수 없습니다" 메시지 표시
- **이미 비활성화된 사용자**: 비활성화 버튼 비활성화 또는 "이미 비활성화된 계정입니다" 메시지 표시
- **토큰이 없는 사용자**: 활성 토큰이 없는 사용자의 "모든 토큰 무효화" 버튼은 비활성화

### 푸시 알림
- **발송 대상 없음**: 대상 사용자가 0명이면 "발송 대상이 없습니다" 메시지 표시 및 발송 버튼 비활성화
- **발송 중 네트워크 오류**: 일부 발송 실패 시 성공/실패 건수를 구분하여 표시하고 재발송 옵션 제공
- **중복 발송 방지**: 같은 알림을 짧은 시간 내 중복 발송하려 할 때 경고 메시지 표시
- **비활성화된 사용자 대상**: 비활성화된 사용자는 발송 대상에서 자동 제외

### 대시보드
- **데이터 없음**: 사용자가 0명일 때 "아직 가입한 사용자가 없습니다" 메시지 표시
- **통계 로딩 실패**: 일부 통계 로딩 실패 시 해당 섹션만 에러 표시하고 나머지는 정상 표시

---

## 비즈니스 규칙

### 인증
- 어드민 인증은 환경변수로 관리되는 고정 크레덴셜을 사용한다
- 세션 만료 시간은 1시간이다
- 로그인 실패 3회 이상 시 5분간 로그인 차단 (선택 사항)

### 사용자 관리
- 비활성화된 사용자는 복구 가능하다 (소프트 삭제)
- 사용자 정보는 수정 불가하고 조회만 가능하다 (OAuth 제공자가 원천)
- 사용자 삭제는 지원하지 않는다 (GDPR 준수는 향후 고려)

### 푸시 알림
- 푸시 알림 제목은 최대 50자, 내용은 최대 200자로 제한한다
- 전체 발송은 FCM 토큰이 등록된 사용자에게만 발송된다
- 발송 실패 시 무효한 FCM 토큰은 자동 비활성화된다
- 푸시 알림 발송 이력은 90일간 보관한다

### 대시보드
- 모든 통계는 실시간이 아닌 최근 5분 이내 데이터를 캐싱하여 표시한다
- 그래프는 최근 7일간 데이터만 표시한다

---

## 필요한 데이터

### 입력 데이터

| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| 어드민 사용자명 | String | ✅ | 로그인 ID |
| 어드민 비밀번호 | String | ✅ | 로그인 비밀번호 |
| 사용자 검색 키워드 | String | ❌ | 이메일/닉네임 검색 |
| 사용자 ID | Number | ✅ | 상세 조회 시 |
| 비활성화 이유 | String | ✅ | 계정 비활성화 시 |
| 푸시 제목 | String | ✅ | 최대 50자 |
| 푸시 내용 | String | ✅ | 최대 200자 |
| 푸시 대상 타입 | Enum | ✅ | "all" 또는 "specific" |
| 푸시 대상 사용자 ID | Number[] | ❌ | specific 선택 시 필수 |

### 출력 데이터

| 데이터 | 타입 | 설명 |
|--------|------|------|
| 사용자 목록 | Array | id, 닉네임, 이메일, 제공자, 가입일, 마지막 로그인, 활성 여부 |
| 사용자 상세 정보 | Object | 기본 정보 + 활성 토큰 수 + 가입 경로 |
| 대시보드 통계 | Object | 총 사용자, 신규 가입, 활성 사용자, 제공자별 비율 |
| 일별 가입 추이 | Array | 날짜별 가입 수 (7일) |
| 푸시 발송 이력 | Array | 발송 시간, 제목, 대상 수, 성공/실패 건수 |
| 푸시 발송 상세 | Object | 전체 내용, 개별 수신 상태, 실패 이유 |

---

## 비기능 요구사항

### 성능
- **페이지 로딩**: 초기 페이지 로딩 시간 3초 이내
- **목록 조회**: 사용자 목록 조회 응답 시간 1초 이내 (1000명 기준)
- **푸시 발송**: 100명 기준 10초 이내 발송 완료

### 접근성
- **모바일 대응**: 태블릿 크기까지 반응형 지원 (모바일 폰은 선택 사항)
- **키보드 네비게이션**: 주요 기능을 키보드만으로 조작 가능
- **명확한 에러 메시지**: 사용자 친화적인 에러 메시지 표시

### 보안
- **HTTPS**: 프로덕션 환경에서 HTTPS 필수
- **세션 관리**: 세션 토큰을 HttpOnly 쿠키로 저장
- **CSRF 방지**: CSRF 토큰 검증
- **민감 정보 보호**: 로그에 비밀번호, 토큰 등 민감 정보 기록 금지

### 에러 처리
- **네트워크 오류**: "서버와 연결할 수 없습니다. 잠시 후 다시 시도해주세요" 표시
- **권한 오류**: "권한이 없습니다. 관리자에게 문의하세요" 표시
- **데이터 없음**: 빈 화면 대신 "데이터가 없습니다" 메시지와 액션 제안 표시
- **치명적 에러**: 에러 바운더리로 캐치하고 "문제가 발생했습니다" 페이지 표시

### 배포 및 운영
- **무료 호스팅**: Vercel Hobby 플랜 (무료) 사용
- **환경 분리**: 개발/프로덕션 환경 분리
- **로깅**: 중요 작업 (사용자 비활성화, 전체 푸시 발송)에 대한 감사 로그 기록
- **모니터링**: Vercel Analytics로 기본 모니터링

---

## 우선순위

이 작업은 **중간** 우선순위입니다.

**근거**:
- 1인 운영 서비스에 필수적인 관리 도구
- 초기에는 서버 API 직접 호출 또는 데이터베이스 직접 조회로 대체 가능
- 사용자 규모 확대 시 효율적 관리를 위해 필요
- 기존 서버 API를 활용하므로 개발 범위가 명확

---

## 참고 사항

### 재사용 가능한 기존 API

이미 구현된 서버 API를 최대한 활용합니다.

| 기능 | 기존 API | 추가 필요 여부 |
|------|----------|---------------|
| 사용자 목록 조회 | ❌ | ✅ 새로 구현 필요 |
| 사용자 상세 조회 | ❌ | ✅ 새로 구현 필요 |
| 사용자 비활성화 | ❌ | ✅ 새로 구현 필요 (또는 스키마에 isActive 컬럼 추가) |
| 토큰 무효화 | `POST /auth/logout` (revokeAll 파라미터) | ✅ 재사용 가능 (어드민 전용 엔드포인트 추가 권장) |
| 푸시 발송 | `POST /push/send` | ✅ 재사용 가능 |
| 푸시 이력 조회 | `GET /push/notifications` | ✅ 재사용 가능 |
| 푸시 상세 조회 | `GET /push/notifications/:id` | ✅ 재사용 가능 |

### 데이터베이스 스키마 확장 고려 사항

현재 `users` 테이블에 `isActive` 또는 `status` 컬럼이 없으므로 추가가 필요할 수 있습니다. 또는 비활성화된 사용자는 별도 테이블로 관리할 수도 있습니다.

### 모노레포 구조

```
apps/
├── server/              # 기존 TypeScript/Express 백엔드
├── mobile/              # 기존 Flutter 모바일 앱
└── web/
    └── admin/           # 새로 추가할 Next.js 어드민 웹 (이 스토리의 대상)
```
