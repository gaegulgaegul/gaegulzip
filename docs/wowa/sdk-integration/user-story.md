# 사용자 스토리: SDK 통합 (SDK Integration)

## 개요

wowa 앱이 4개의 재사용 가능한 SDK 패키지(auth_sdk, push, notice, qna)를 올바르게 사용하여 사용자에게 일관되고 안정적인 경험을 제공하는 기능입니다. SDK 패키지는 여러 앱에서 공통으로 사용할 수 있도록 설계되었으며, wowa 앱은 이를 정확히 통합하여 중복 코드를 제거하고 유지보수성을 향상시킵니다.

**비즈니스 가치**:
- 개발 효율성 향상 (중복 코드 제거, SDK 재사용)
- 유지보수성 개선 (SDK 단위 업데이트 시 모든 앱에 일괄 반영)
- 코드 품질 향상 (검증된 SDK 사용으로 버그 감소)
- 확장성 보장 (새로운 앱 추가 시 SDK를 즉시 재사용 가능)

## 사용자 스토리

### US-1: 소셜 로그인 SDK 사용
- **As a** wowa 앱 개발자
- **I want to** auth_sdk의 소셜 로그인 기능을 사용하여 로그인 화면을 구현하고
- **So that** 앱 내 중복 인증 로직을 제거하고 SDK에서 제공하는 검증된 인증 흐름을 사용할 수 있다

### US-2: 푸시 알림 SDK 사용
- **As a** wowa 앱 사용자
- **I want to** 푸시 알림을 받고 앱 내에서 알림 목록을 확인할 수 있고
- **So that** 중요한 정보를 놓치지 않고 과거 알림도 다시 확인할 수 있다

### US-3: 공지사항 SDK 통합
- **As a** wowa 앱 사용자
- **I want to** 앱 내에서 공지사항 목록을 보고 상세 내용을 확인할 수 있고
- **So that** 앱 업데이트, 이벤트, 점검 정보 등을 파악할 수 있다

### US-4: QnA SDK 사용
- **As a** wowa 앱 사용자
- **I want to** 앱 내에서 질문을 제출할 수 있고
- **So that** 문의사항이나 피드백을 개발팀에 전달할 수 있다

### US-5: 중복 코드 제거
- **As a** wowa 앱 개발자
- **I want to** 앱 내부의 인증 관련 중복 구현을 SDK로 대체하고
- **So that** 코드 중복을 제거하고 SDK의 최신 기능을 자동으로 사용할 수 있다

### US-6: 통합된 인증 상태 관리
- **As a** wowa 앱 사용자
- **I want to** 앱 전체에서 일관된 인증 상태를 유지하고
- **So that** 로그인 후 모든 기능(푸시, 공지, QnA)에서 자동으로 내 정보가 반영된다

### US-7: 공지사항 접근성
- **As a** wowa 앱 사용자
- **I want to** 앱의 메인 화면이나 설정 화면에서 공지사항으로 쉽게 이동할 수 있고
- **So that** 중요한 공지사항을 빠르게 확인할 수 있다

### US-8: 읽지 않은 공지사항 표시
- **As a** wowa 앱 사용자
- **I want to** 읽지 않은 공지사항의 개수를 앱 내에서 뱃지로 볼 수 있고
- **So that** 새로운 공지사항이 있는지 한눈에 파악할 수 있다

## 사용자 시나리오

### 시나리오 1: 사용자가 auth_sdk로 로그인하는 정상 플로우
1. 사용자가 wowa 앱을 처음 실행한다
2. 로그인 화면이 표시된다
3. 사용자가 카카오 로그인 버튼을 탭한다
4. auth_sdk가 카카오 OAuth 프로세스를 처리한다
5. 로그인 성공 시 auth_sdk가 토큰을 안전하게 저장한다
6. 사용자가 홈 화면으로 이동한다
7. 결과: 사용자가 auth_sdk를 통해 안전하게 인증되고 앱의 모든 기능을 사용할 수 있다

### 시나리오 2: 로그인 후 푸시 알림 수신 (정상 플로우)
1. 사용자가 로그인한다
2. push SDK가 디바이스 토큰을 자동으로 서버에 등록한다
3. 서버에서 푸시 알림을 발송한다
4. 사용자가 알림을 받고 탭한다
5. 앱이 실행되고 관련 화면으로 이동한다
6. 사용자가 앱 내 알림 목록 화면으로 이동한다
7. push SDK가 제공하는 목록 화면에서 과거 알림을 확인한다
8. 결과: 사용자가 실시간 알림과 히스토리를 모두 확인할 수 있다

### 시나리오 3: 공지사항 조회 (정상 플로우)
1. 사용자가 로그인 후 홈 화면에 있다
2. 사용자가 공지사항 메뉴를 탭한다
3. notice SDK의 목록 화면이 표시된다
4. 시스템이 wowa 앱의 공지사항만 조회한다
5. 고정 공지사항이 상단에 표시되고, 읽지 않은 공지는 강조 표시된다
6. 사용자가 특정 공지사항을 탭한다
7. notice SDK의 상세 화면이 표시되고 자동으로 읽음 처리된다
8. 사용자가 뒤로 가기를 누르면 목록에서 해당 공지가 읽음 상태로 변경되어 있다
9. 결과: 사용자가 공지사항을 조회하고 읽음 상태가 자동으로 관리된다

### 시나리오 4: 읽지 않은 공지사항 뱃지 표시 (정상 플로우)
1. 사용자가 로그인한다
2. 시스템이 notice SDK를 통해 읽지 않은 공지사항 개수를 조회한다
3. 앱의 공지사항 메뉴 아이콘에 읽지 않은 개수가 뱃지로 표시된다
4. 사용자가 공지사항을 확인하고 읽는다
5. 뱃지의 숫자가 자동으로 감소한다
6. 결과: 사용자가 새 공지사항 여부를 한눈에 파악할 수 있다

### 시나리오 5: QnA 질문 제출 (정상 플로우)
1. 사용자가 앱 내 설정 화면에서 "문의하기"를 탭한다
2. qna SDK의 질문 작성 화면이 표시된다
3. 사용자가 제목과 본문을 입력한다
4. 사용자가 "질문 제출" 버튼을 탭한다
5. qna SDK가 자동으로 appCode를 'wowa'로 설정하여 서버에 전송한다
6. 서버가 GitHub Issue를 자동 생성한다
7. 성공 모달이 표시되고 이전 화면으로 돌아간다
8. 결과: 사용자가 wowa 앱의 질문을 성공적으로 제출할 수 있다

### 시나리오 6: 중복 코드 제거 후 SDK 사용 (개발자 플로우)
1. 개발자가 wowa 앱의 auth_repository.dart를 확인한다
2. auth_sdk와 중복되는 로직을 발견한다
3. 개발자가 앱 내 중복 파일을 삭제한다
4. 개발자가 auth_sdk에서 직접 import하도록 변경한다
5. 앱을 빌드하고 테스트한다
6. 로그인, 로그아웃, 토큰 갱신이 정상 동작한다
7. 결과: 중복 코드가 제거되고 SDK의 검증된 로직만 사용한다

### 시나리오 7: 토큰 자동 갱신 (투명한 동작)
1. 사용자가 로그인 후 앱을 사용한다
2. 시간이 지나 액세스 토큰이 만료된다
3. 사용자가 공지사항 목록을 조회한다
4. auth_sdk의 AuthInterceptor가 401 에러를 감지한다
5. AuthInterceptor가 자동으로 리프레시 토큰으로 새 액세스 토큰을 발급받는다
6. 원래 요청(공지사항 목록)이 자동으로 재시도되고 성공한다
7. 사용자는 아무런 오류를 경험하지 않는다
8. 결과: 사용자가 토큰 만료를 의식하지 않고 원활하게 앱을 사용할 수 있다

### 시나리오 8: 멀티테넌트 데이터 격리 (정상 플로우)
1. 사용자가 wowa 앱에서 로그인한다
2. auth_sdk가 인증 토큰에 appCode: 'wowa'를 포함한다
3. 사용자가 공지사항을 조회한다
4. notice SDK가 서버에 요청을 보낸다
5. 서버가 토큰에서 appCode를 추출하여 wowa 앱의 공지사항만 반환한다
6. 사용자가 QnA를 제출한다
7. qna SDK가 appCode: 'wowa'로 질문을 전송한다
8. 서버가 wowa 전용 GitHub 리포지토리에 Issue를 생성한다
9. 결과: 각 앱의 데이터가 격리되어 다른 앱의 데이터에 접근할 수 없다

### 시나리오 9: SDK 업데이트 시 자동 반영 (개발자 플로우)
1. auth_sdk에 새로운 소셜 로그인 프로바이더가 추가된다
2. 개발자가 wowa 앱의 pubspec.yaml에서 auth_sdk를 최신 버전으로 업데이트한다
3. melos bootstrap을 실행한다
4. 앱 코드 수정 없이 새 프로바이더가 사용 가능해진다
5. 결과: SDK 업데이트만으로 모든 앱이 새 기능을 사용할 수 있다

## 인수 조건 (Acceptance Criteria)

### auth_sdk 통합
- [ ] wowa 앱의 로그인 화면이 auth_sdk를 사용한다
- [ ] wowa 앱 내부의 중복 인증 코드(auth_repository, auth_interceptor, auth_state_service, social_login_provider)가 제거된다
- [ ] auth_sdk에서 직접 import하여 사용한다
- [ ] 로그인, 로그아웃, 토큰 갱신이 정상 동작한다
- [ ] 4개 소셜 프로바이더(카카오, 네이버, 구글, 애플)가 모두 동작한다

### push SDK 통합
- [ ] push SDK가 wowa 앱에 등록되어 있다
- [ ] 앱 실행 시 push SDK가 자동으로 초기화된다
- [ ] 포그라운드, 백그라운드, 종료 상태에서 푸시 알림을 받을 수 있다
- [ ] 앱 내 알림 목록 화면이 동작한다
- [ ] 알림 탭 시 관련 화면으로 이동한다

### notice SDK 통합
- [ ] notice SDK가 wowa 앱의 pubspec.yaml에 등록된다
- [ ] NoticeApiService가 전역으로 등록된다
- [ ] 공지사항 목록 라우트와 상세 라우트가 app_pages.dart에 등록된다
- [ ] 앱 내에서 공지사항 목록으로 이동할 수 있다
- [ ] 공지사항 목록에서 고정 공지사항이 상단에 표시된다
- [ ] 공지사항을 탭하면 상세 화면으로 이동하고 읽음 처리된다
- [ ] 읽지 않은 공지사항이 시각적으로 구분된다

### qna SDK 통합
- [ ] qna SDK가 wowa 앱에 등록되어 있다
- [ ] 설정 화면이나 메뉴에서 QnA 화면으로 이동할 수 있다
- [ ] QnA 제출 시 appCode가 'wowa'로 설정된다
- [ ] 질문 제출이 성공적으로 동작한다

### 읽지 않은 공지사항 뱃지
- [ ] 앱 내 공지사항 메뉴에 읽지 않은 개수가 뱃지로 표시된다
- [ ] 공지사항을 읽으면 뱃지 숫자가 자동으로 감소한다
- [ ] 읽지 않은 공지가 없으면 뱃지가 숨겨진다

### 인증 상태 동기화
- [ ] 로그인 후 모든 SDK(push, notice, qna)가 인증된 사용자로 동작한다
- [ ] 토큰이 만료되면 AuthInterceptor가 자동으로 갱신한다
- [ ] 토큰 갱신 실패 시 사용자가 로그인 화면으로 이동한다
- [ ] 로그아웃 시 모든 SDK의 데이터가 초기화된다

### 멀티테넌트 격리
- [ ] 공지사항 조회 시 wowa 앱의 공지사항만 표시된다
- [ ] QnA 제출 시 wowa 전용 GitHub 리포지토리에 Issue가 생성된다
- [ ] 푸시 알림 목록에 wowa 앱의 알림만 표시된다

## 엣지 케이스

- **SDK가 미초기화 상태에서 기능 호출**: 에러 메시지를 표시하고 앱이 크래시하지 않는다
- **notice SDK 라우트 미등록 상태에서 네비게이션 시도**: GetX 라우트 에러가 발생하고 개발자에게 명확한 에러 메시지를 표시한다
- **NoticeApiService가 DI에 미등록된 상태**: Get.find() 실패 시 명확한 에러 메시지를 표시한다
- **중복 코드 제거 중 누락된 import**: 컴파일 에러가 발생하고 빌드가 실패한다
- **auth_sdk 업데이트 후 호환성 문제**: 앱 빌드 시 타입 에러나 메서드 미존재 에러가 발생한다
- **공지사항 뱃지 API 호출 실패**: 뱃지가 0으로 표시되거나 숨겨지고, 비치명적 오류로 처리된다
- **공지사항 상세 조회 시 삭제된 공지**: 404 에러 메시지를 표시하고 목록으로 돌아간다
- **QnA 제출 중 네트워크 오류**: 재시도 옵션을 제공하고 사용자가 입력한 내용을 유지한다
- **토큰 갱신 실패 시 무한 재시도**: 최대 재시도 횟수를 제한하고 로그인 화면으로 이동한다
- **앱 재설치 후 푸시 알림 목록 조회**: 서버에서 과거 알림 히스토리를 정상적으로 조회한다

## 비즈니스 규칙

- **SDK 독립성**: 각 SDK는 독립적으로 동작하며, 한 SDK의 실패가 다른 SDK에 영향을 주지 않는다
- **앱 코드 격리**: 모든 SDK는 appCode를 통해 앱을 식별하고 데이터를 격리한다
- **인증 전파**: auth_sdk의 토큰이 모든 HTTP 요청에 자동으로 포함된다
- **자동 토큰 갱신**: 액세스 토큰 만료 시 AuthInterceptor가 자동으로 갱신하고 원래 요청을 재시도한다
- **중복 코드 금지**: 앱 내부에 SDK와 중복되는 로직을 구현하지 않는다
- **SDK 버전 일관성**: wowa 앱은 항상 최신 안정 버전의 SDK를 사용한다
- **에러 전파**: SDK에서 발생한 에러는 앱에서 처리하고 사용자에게 적절한 메시지를 표시한다
- **읽음 상태 동기화**: 공지사항 상세 조회 시 서버와 로컬 상태가 동기화된다
- **뱃지 업데이트 정책**: 공지사항을 읽을 때마다 뱃지가 자동으로 업데이트된다

## 필요한 데이터

### SDK 초기화 정보
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| appCode | String | ✅ | 앱 식별 코드 (wowa) |
| apiBaseUrl | String | ✅ | API 서버 URL |

### 공지사항 뱃지 데이터
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| unreadCount | Integer | ✅ | 읽지 않은 공지사항 개수 |

### 라우트 정보
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| noticeListRoute | String | ✅ | 공지사항 목록 경로 (/notice/list) |
| noticeDetailRoute | String | ✅ | 공지사항 상세 경로 (/notice/detail) |
| noticeId | Integer | ✅ | 상세 조회용 공지사항 ID (arguments) |

### 네비게이션 데이터
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| menuIcon | Widget | ✅ | 공지사항 메뉴 아이콘 |
| badgeCount | Integer | ❌ | 뱃지에 표시할 읽지 않은 개수 |

## 비기능 요구사항

### 성능
- **SDK 초기화 시간**: 앱 시작 후 3초 이내 모든 SDK 초기화 완료
- **공지사항 목록 로딩**: 1초 이내 첫 페이지 표시
- **뱃지 업데이트**: 공지사항 읽음 처리 후 500ms 이내 뱃지 반영
- **토큰 갱신**: 3초 이내 완료 (네트워크 정상 상태)

### 접근성
- **공지사항 접근**: 메인 화면에서 최대 2번의 탭으로 공지사항 목록 접근 가능
- **읽지 않은 표시**: 읽지 않은 공지사항이 명확히 구분됨
- **뱃지 가시성**: 뱃지가 메뉴 아이콘과 대비되어 명확히 보임

### 에러 처리
- **SDK 초기화 실패**: 앱이 크래시하지 않고 에러를 로깅하며 재시도 옵션 제공
- **NoticeApiService 미등록**: "서비스 초기화 오류" 메시지 표시 및 개발자에게 명확한 로그 제공
- **라우트 미등록**: "페이지를 찾을 수 없습니다" 메시지 표시
- **네트워크 오류**: "네트워크 연결을 확인해주세요" 메시지 및 재시도 버튼 제공
- **토큰 갱신 실패**: 로그인 화면으로 자동 이동 및 "다시 로그인해주세요" 안내

### 보안
- **토큰 저장**: auth_sdk가 Secure Storage를 사용하여 토큰을 암호화 저장
- **앱 코드 검증**: 서버에서 토큰의 appCode를 검증하여 다른 앱의 데이터 접근 차단
- **중복 코드 제거**: 검증되지 않은 앱 내 인증 로직 제거로 보안 취약점 최소화

### 유지보수성
- **SDK 버전 관리**: pubspec.yaml에서 SDK 버전을 명시적으로 관리
- **의존성 일관성**: melos bootstrap으로 모든 패키지 의존성 동기화
- **코드 중복 최소화**: SDK와 중복되는 코드를 앱에서 완전히 제거
- **에러 로깅**: 모든 SDK 에러를 중앙 로거에 기록

### 확장성
- **새 SDK 추가**: pubspec.yaml에 의존성 추가 및 초기화 코드 작성만으로 통합 가능
- **SDK 업데이트**: SDK 버전 변경 시 앱 코드 수정 최소화
- **멀티테넌트 지원**: 동일한 SDK를 여러 앱에서 재사용 가능
