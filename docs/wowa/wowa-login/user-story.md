# 사용자 스토리: 로그인 화면 SDK 재사용성 개선

## 개요

현재 auth_sdk 패키지는 소셜 로그인 **로직**(Provider, Repository, Service, Model)만 제공하고, 로그인 **화면**(View, Controller, Binding)은 wowa 앱 내부에 위치합니다. 이로 인해 다른 앱에서 동일한 로그인 화면을 사용하려면 파일을 복사해야 하는 중복 문제가 발생합니다.

로그인 화면 컴포넌트를 auth_sdk 패키지로 이동하여 모든 앱에서 동일한 로그인 경험을 재사용할 수 있도록 개선합니다. 이를 통해 코드 중복을 제거하고, 로그인 화면의 일관성과 유지보수성을 높입니다.

**비즈니스 가치**: 로그인 화면을 SDK 수준에서 공통 관리하여 개발 속도를 높이고, 모든 제품에서 동일한 로그인 UX를 제공하며, 보안 업데이트와 UI 개선을 한 곳에서 관리할 수 있습니다.

---

## 사용자 페르소나

### 1. 앱 사용자 (Primary)
- **특징**: gaegulzip 제품군(wowa 등)을 사용하는 일반 사용자
- **니즈**: 간편하고 안전하게 로그인하여 서비스를 이용하고 싶음
- **행동**: 소셜 로그인 버튼을 눌러 인증하거나, 둘러보기로 비인증 상태로 진입

### 2. 앱 개발자 (Secondary)
- **특징**: gaegulzip 생태계에서 새 앱을 개발하는 개발자
- **니즈**: 로그인 화면을 직접 구현하지 않고 SDK 패키지로 즉시 사용하고 싶음
- **행동**: auth_sdk를 설치하고 라우트에 등록만 하면 로그인 기능 사용 가능

### 3. 제품 관리자 (Tertiary)
- **특징**: 여러 제품의 로그인 경험을 관리하는 관리자
- **니즈**: 모든 제품에서 일관된 로그인 UI/UX를 유지하고, 한 곳에서 개선하고 싶음
- **행동**: SDK 업데이트 한 번으로 모든 앱에 변경사항 적용

---

## 사용자 스토리

### US-1: 소셜 로그인 선택
- **As a** 앱 사용자
- **I want to** 카카오, 네이버, 구글, 애플 4개 소셜 로그인 중 하나를 선택할 수 있다
- **So that** 내가 사용하는 계정으로 간편하게 로그인할 수 있다

### US-2: 로그인 진행 상태 확인
- **As a** 앱 사용자
- **I want to** 로그인 버튼을 누른 후 진행 상태를 시각적으로 확인할 수 있다
- **So that** 로그인이 진행 중인지, 완료되었는지 알 수 있다

### US-3: 로그인 성공 시 자동 이동
- **As a** 앱 사용자
- **I want to** 로그인 성공 시 별도 확인 없이 홈 화면으로 자동 이동한다
- **So that** 빠르게 서비스를 이용할 수 있다

### US-4: 로그인 실패 피드백
- **As a** 앱 사용자
- **I want to** 로그인 실패 시 실패 이유를 이해할 수 있는 메시지를 받는다
- **So that** 문제를 인지하고 재시도하거나 다른 방법을 시도할 수 있다

### US-5: 계정 충돌 해결
- **As a** 앱 사용자
- **I want to** 동일한 이메일로 다른 프로바이더에 이미 가입된 경우 안내 메시지를 받는다
- **So that** 기존 계정 정보를 확인하고 올바른 방법으로 로그인할 수 있다

### US-6: 사용자 취소 허용
- **As a** 앱 사용자
- **I want to** 소셜 로그인 도중 취소할 수 있다
- **So that** 로그인하지 않기로 마음을 바꿀 수 있다

### US-7: 비인증 둘러보기 (선택적)
- **As a** 앱 사용자
- **I want to** 로그인 없이 "둘러보기" 버튼으로 앱을 체험할 수 있다
- **So that** 회원가입 전에 서비스를 미리 확인할 수 있다
- **Note**: 둘러보기 버튼은 앱별로 활성화/비활성화 가능 (SDK 설정으로 제어)

### US-8: SDK 간편 통합 (개발자)
- **As a** 앱 개발자
- **I want to** auth_sdk 패키지를 설치하고 라우트에 등록만 하면 로그인 화면을 사용할 수 있다
- **So that** 로그인 화면을 직접 개발하지 않고 즉시 사용할 수 있다

### US-9: 앱별 커스터마이징 (개발자)
- **As a** 앱 개발자
- **I want to** 로그인 성공 후 이동할 라우트를 앱별로 설정할 수 있다
- **So that** 앱 구조에 맞는 화면 전환 흐름을 구성할 수 있다

### US-10: 일관된 UI 유지 (제품 관리자)
- **As a** 제품 관리자
- **I want to** 모든 제품에서 동일한 로그인 화면 디자인을 제공한다
- **So that** 사용자에게 일관된 브랜드 경험을 제공할 수 있다

---

## 사용자 시나리오

### 시나리오 1: 사용자가 카카오로 로그인하는 정상 플로우
1. 사용자가 로그인 화면에 진입한다
2. 시스템이 4개 소셜 로그인 버튼(카카오, 네이버, 애플, 구글)과 둘러보기 버튼을 표시한다
3. 사용자가 "카카오로 시작하기" 버튼을 누른다
4. 시스템이 버튼을 로딩 상태로 전환한다 (스피너 표시, 다른 버튼 비활성화)
5. 시스템이 카카오 로그인 SDK를 호출한다
6. 사용자가 카카오톡 또는 브라우저에서 로그인 및 동의 절차를 완료한다
7. 시스템이 인가 코드를 받아 서버에 전송한다
8. 서버가 액세스 토큰과 사용자 정보를 반환한다
9. 시스템이 토큰을 안전하게 저장한다
10. 시스템이 홈 화면으로 자동 이동한다
11. **결과**: 사용자가 카카오 계정으로 로그인되어 서비스를 이용할 수 있다

### 시나리오 2: 사용자가 로그인 도중 취소하는 플로우
1. 사용자가 구글 로그인 버튼을 누른다
2. 시스템이 구글 로그인 화면을 표시한다
3. 사용자가 로그인 화면에서 "취소" 또는 뒤로가기를 누른다
4. 시스템이 로그인 프로세스를 중단한다
5. 시스템이 로딩 상태를 해제하고 로그인 화면으로 복귀한다
6. 시스템이 별도 에러 메시지를 표시하지 않는다
7. **결과**: 사용자가 다시 로그인을 시도하거나 둘러보기를 선택할 수 있다

### 시나리오 3: 네트워크 오류로 로그인 실패하는 플로우
1. 사용자가 네이버 로그인 버튼을 누른다
2. 시스템이 네이버 로그인 SDK를 호출하여 토큰을 받는다
3. 시스템이 서버에 토큰을 전송하려 하지만 네트워크 연결이 끊긴다
4. 시스템이 네트워크 오류를 감지한다
5. 시스템이 로딩 상태를 해제한다
6. 시스템이 화면 하단에 "네트워크 연결을 확인해주세요" 스낵바를 표시한다
7. 사용자가 네트워크를 확인하고 다시 로그인을 시도한다
8. **결과**: 사용자가 문제를 인지하고 재시도할 수 있다

### 시나리오 4: 계정 충돌이 발생하는 플로우
1. 사용자가 이전에 카카오로 가입한 이메일을 사용하여 구글로 로그인을 시도한다
2. 시스템이 구글 토큰을 서버로 전송한다
3. 서버가 계정 충돌 오류를 반환한다 (409 Conflict, existingProvider: 'kakao')
4. 시스템이 로딩 상태를 해제한다
5. 시스템이 모달을 표시한다: "이 이메일은 카카오 계정으로 가입되어 있습니다"
6. 모달에 "취소"와 "카카오로 로그인" 버튼이 표시된다
7. 사용자가 "카카오로 로그인" 버튼을 누른다
8. 시스템이 모달을 닫고 카카오 로그인 프로세스를 시작한다
9. **결과**: 사용자가 올바른 프로바이더로 로그인할 수 있다

### 시나리오 5: 사용자가 둘러보기로 진입하는 플로우
1. 사용자가 로그인 화면에 진입한다
2. 사용자가 화면 하단의 "둘러보기" 버튼을 누른다
3. 시스템이 로그인 절차 없이 홈 화면으로 이동한다
4. 시스템이 사용자를 비인증 상태로 유지한다
5. **결과**: 사용자가 로그인 없이 제한된 기능을 체험할 수 있다

### 시나리오 6: 개발자가 새 앱에 로그인 화면을 추가하는 플로우
1. 개발자가 새 앱 프로젝트를 생성한다
2. 개발자가 `pubspec.yaml`에 `auth_sdk` 패키지를 추가한다
3. 개발자가 앱 라우트 설정에 로그인 화면 라우트를 등록한다
4. 개발자가 로그인 성공 후 이동할 라우트를 설정한다 (예: `homeRoute: '/dashboard'`)
5. 개발자가 앱을 실행한다
6. 시스템이 auth_sdk의 로그인 화면을 표시한다
7. 사용자가 소셜 로그인을 완료한다
8. 시스템이 `/dashboard`로 자동 이동한다
9. **결과**: 개발자가 로그인 화면을 직접 개발하지 않고 즉시 사용할 수 있다

### 시나리오 7: 제품 관리자가 로그인 UI를 일괄 업데이트하는 플로우
1. 제품 관리자가 로그인 화면의 디자인 개선을 요청한다
2. 개발자가 auth_sdk 패키지의 로그인 화면만 수정한다
3. 개발자가 auth_sdk 패키지를 새 버전으로 배포한다
4. 각 앱 개발자가 패키지 버전을 업데이트한다
5. 모든 앱에 새로운 로그인 디자인이 적용된다
6. **결과**: 한 곳에서 수정하여 모든 제품에 일관된 경험을 제공할 수 있다

---

## 인수 조건 (Acceptance Criteria)

### 기본 기능
- [ ] 사용자가 카카오, 네이버, 구글, 애플 4개 소셜 로그인 버튼을 볼 수 있다
- [ ] 각 버튼은 브랜드 가이드라인에 맞는 색상과 로고를 사용한다
- [ ] 사용자가 버튼을 누르면 해당 프로바이더의 로그인 프로세스가 시작된다
- [ ] 로그인 진행 중에는 선택한 버튼에 로딩 인디케이터가 표시된다
- [ ] 로그인 진행 중에는 다른 버튼이 비활성화된다

### 로그인 성공
- [ ] 로그인 성공 시 액세스 토큰, 리프레시 토큰, 사용자 정보가 안전하게 저장된다
- [ ] 로그인 성공 시 홈 화면으로 자동 이동한다
- [ ] 로그인 성공 시 별도의 성공 메시지를 표시하지 않는다 (즉시 이동)

### 에러 처리
- [ ] 사용자 취소 시 아무 메시지 없이 로그인 화면으로 복귀한다
- [ ] 네트워크 오류 시 "네트워크 연결을 확인해주세요" 스낵바를 표시한다
- [ ] 서버 오류 시 "로그인 중 오류가 발생했습니다" 스낵바를 표시한다
- [ ] 계정 충돌 시 "다른 계정으로 가입되어 있습니다" 모달을 표시한다
- [ ] 권한 오류 시 "권한을 허용해주세요" 스낵바를 표시한다

### 계정 충돌 모달
- [ ] 모달에 기존 프로바이더 정보가 한글로 표시된다 (예: "카카오", "네이버")
- [ ] 모달에 "취소"와 "연동하기" 버튼이 표시된다
- [ ] "취소" 버튼을 누르면 모달이 닫히고 로그인 화면으로 돌아간다
- [ ] "연동하기" 버튼은 현재 기능이 미구현 상태임을 안내한다 (향후 구현)

### 둘러보기 (선택적)
- [ ] 둘러보기 버튼은 SDK 설정으로 활성화/비활성화할 수 있다 (기본값: 비활성화)
- [ ] 활성화 시, 사용자가 "둘러보기" 버튼을 눌러 비인증 상태로 홈 화면에 진입할 수 있다
- [ ] 활성화 시, 둘러보기 버튼은 화면 하단에 텍스트 버튼으로 표시된다

### SDK 통합 (개발자 관점)
- [ ] auth_sdk 패키지에 LoginView, LoginController, LoginBinding이 포함된다
- [ ] 앱 개발자는 auth_sdk의 로그인 라우트를 앱 라우트에 등록하여 사용할 수 있다
- [ ] 로그인 성공 후 이동할 라우트를 SDK 초기화 시 설정할 수 있다
- [ ] SDK는 design_system 패키지의 SocialLoginButton을 사용한다
- [ ] SDK는 앱에 의존하지 않고 독립적으로 동작한다

### 일관성
- [ ] wowa 앱의 기존 로그인 기능이 SDK 이동 후에도 동일하게 동작한다
- [ ] 모든 소셜 프로바이더의 로그인 플로우가 동일한 UX를 제공한다
- [ ] 로딩 상태, 에러 메시지, 모달 디자인이 Frame0 스케치 스타일을 따른다

---

## 엣지 케이스

### 사용자 행동
- **로그인 중 앱 종료**: 앱 재시작 시 로그인 화면에서 다시 시작, 부분 완료된 토큰은 무시
- **로그인 중 백그라운드 전환**: 포그라운드 복귀 시 로그인 프로세스 계속 진행 (SDK 타임아웃 내)
- **빠른 연속 클릭**: 로딩 상태 동안 다른 버튼 클릭 무시 (버튼 비활성화)
- **둘러보기 후 로그인 시도**: 홈 화면에서 로그인 메뉴로 진입 가능 (앱별 구현)

### 프로바이더 SDK 오류
- **카카오톡 미설치**: 브라우저 로그인으로 자동 전환
- **구글 계정 없음**: 구글 SDK가 에러 반환 → "로그인 실패" 스낵바
- **애플 로그인 불가 기기**: iOS 13 이하 → "애플 로그인을 지원하지 않는 기기입니다" 스낵바
- **네이버 앱 강제 종료**: 사용자 취소로 처리 (AuthException code: 'user_cancelled')

### 네트워크 및 서버
- **토큰 전송 타임아웃**: 10초 후 "네트워크 연결을 확인해주세요" 스낵바
- **서버 점검 중 (503)**: "일시적인 오류가 발생했습니다" 스낵바
- **유효하지 않은 토큰 (401)**: "로그인 중 오류가 발생했습니다" 스낵바
- **계정 충돌 (409)**: 모달 표시 (시나리오 4)

### 데이터 저장

- **토큰 저장 실패**: 로그인 성공 직후 저장 실패 시 → "로그인 중 오류가 발생했습니다" 스낵바, 다시 시도
- **저장소 권한 없음**: 앱 설치 직후 드문 케이스 → "권한을 허용해주세요" 스낵바

### SDK 통합 (개발자)

- **homeRoute 미설정**: SDK 기본값 '/home' 사용
- **잘못된 라우트 설정**: 라우트 이동 실패 → GetX 라우트 에러 (개발자 콘솔 경고)
- **design_system 미설치**: 앱 빌드 시 의존성 에러 → 개발 단계에서 발견

---

## 비즈니스 규칙

### BR-1: SDK 독립성
- auth_sdk 패키지는 wowa 앱에 의존하지 않고 독립적으로 동작합니다
- 로그인 화면은 appCode, homeRoute 등 설정을 주입받아 동작합니다
- 특정 앱의 하드코딩된 라우트, 앱 이름을 포함하지 않습니다

### BR-2: 소셜 프로바이더 우선순위
- 4개 프로바이더는 동등한 우선순위를 가지며, UI에서 순서는 카카오 → 네이버 → 애플 → 구글입니다
- 향후 새 프로바이더 추가 시 SDK 업데이트만으로 모든 앱에 적용 가능합니다

### BR-3: 에러 처리 계층
- 사용자 취소: 조용히 실패 (메시지 없음)
- 네트워크 오류: 사용자가 이해할 수 있는 메시지 (재시도 가능)
- 계정 충돌: 모달로 명확한 안내 및 해결 방법 제시
- 기타 오류: 일반 메시지 ("로그인 중 오류가 발생했습니다")

### BR-4: 토큰 저장 정책
- 액세스 토큰, 리프레시 토큰은 SecureStorage에 암호화 저장됩니다
- 사용자 정보(ID, provider, email 등)는 SecureStorage에 저장됩니다
- 로그인 성공 전 저장 실패 시 로그인을 실패로 처리합니다

### BR-5: 로딩 상태 표시
- 로그인 버튼 클릭 후 즉시 로딩 상태로 전환합니다 (사용자 피드백)
- 로딩 중에는 선택한 버튼만 스피너 표시, 나머지 버튼은 비활성화됩니다
- 로그인 완료 또는 실패 시 로딩 상태를 해제합니다

### BR-6: 일관된 UX
- 모든 프로바이더의 로그인 플로우는 동일한 로딩 상태, 에러 메시지 패턴을 따릅니다
- 디자인은 Frame0 스케치 스타일(design_system 패키지)을 사용합니다
- 에러 스낵바는 화면 하단, 3초 표시, 빨간색 배경입니다

### BR-7: 둘러보기 정책
- 둘러보기는 SDK 설정(`showBrowseButton`)으로 활성화/비활성화 가능합니다 (기본값: 비활성화)
- 활성화 시, 로그인 화면 하단에 둘러보기 버튼을 제공합니다
- 둘러보기로 진입한 사용자는 제한된 기능만 사용 가능합니다 (앱별 구현)

---

## 필요한 데이터

### SDK 초기화 설정 (앱 개발자 → SDK)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| appCode | 문자열 | ✅ | 앱 식별 코드 (예: "wowa") |
| apiBaseUrl | 문자열 | ✅ | 서버 API 기본 URL |
| homeRoute | 문자열 | ❌ | 로그인 성공 후 이동할 라우트 (기본값: '/home') |
| showBrowseButton | 불리언 | ❌ | 둘러보기 버튼 표시 여부 (기본값: false) |
| providers | Map\<SocialProvider, ProviderConfig\> | ✅ | 소셜 프로바이더별 설정 맵. 각 ProviderConfig는 clientId(선택), clientSecret(선택) 포함 |

### 로그인 요청 (SDK → 서버)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| provider | 문자열 | ✅ | 소셜 프로바이더 ('kakao', 'naver', 'google', 'apple') |
| code | 문자열 | ✅ | 프로바이더에서 받은 인가 코드 또는 액세스 토큰 |
| appCode | 문자열 | ✅ | 앱 식별 코드 |

### 로그인 응답 (서버 → SDK)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| accessToken | 문자열 | ✅ | JWT 액세스 토큰 |
| refreshToken | 문자열 | ✅ | JWT 리프레시 토큰 |
| tokenType | 문자열 | ✅ | 토큰 타입 ("Bearer") |
| expiresIn | 숫자 | ✅ | 만료 시간 (초) |
| user | 객체 | ✅ | 사용자 정보 (id, provider, email, nickname, profileImage) |

### 에러 응답 (서버 → SDK)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| code | 문자열 | ✅ | 에러 코드 ('user_cancelled', 'account_conflict', 'permission_denied' 등) |
| message | 문자열 | ✅ | 에러 메시지 |
| existingProvider | 문자열 | ❌ | 계정 충돌 시 기존 프로바이더 ('kakao', 'naver', 'google', 'apple') |

### 내부 상태 (SDK Controller)
| 데이터 | 타입 | 필수 | 설명 |
|--------|------|------|------|
| isKakaoLoading | 불리언 | ✅ | 카카오 로그인 로딩 상태 |
| isNaverLoading | 불리언 | ✅ | 네이버 로그인 로딩 상태 |
| isGoogleLoading | 불리언 | ✅ | 구글 로그인 로딩 상태 |
| isAppleLoading | 불리언 | ✅ | 애플 로그인 로딩 상태 |

---

## 비기능 요구사항

### 성능
- **로그인 화면 렌더링**: 1초 이내 (4개 버튼 + 둘러보기 버튼)
- **프로바이더 SDK 호출**: 각 SDK의 표준 응답 시간 (카카오 1~3초, 네이버 2~4초 등)
- **서버 API 호출**: 3초 이내 응답 (정상 네트워크 환경)
- **토큰 저장**: 100ms 이내 (SecureStorage)

### 접근성
- **로딩 표시**: 로그인 진행 중 명확한 로딩 인디케이터 (스피너)
- **에러 메시지**: 사용자가 이해할 수 있는 한글 메시지
- **버튼 크기**: 터치하기 쉬운 크기 (최소 48px 높이)
- **색상 대비**: 브랜드 가이드라인 준수 (카카오 노란색, 네이버 초록색 등)

### 에러 처리
- **네트워크 오류**: "네트워크 연결을 확인해주세요" 스낵바, 재시도 가능
- **서버 오류**: "로그인 중 오류가 발생했습니다" 스낵바
- **계정 충돌**: 모달로 기존 프로바이더 안내, 취소/연동 선택 제공
- **권한 오류**: "권한을 허용해주세요" 스낵바
- **사용자 취소**: 메시지 없이 로그인 화면으로 복귀

### 보안
- **토큰 저장**: SecureStorage에 암호화 저장
- **로그 민감 정보**: 액세스 토큰, 리프레시 토큰을 로그에 기록하지 않음
- **프로바이더 검증**: 서버에서 각 프로바이더 토큰 유효성 검증

### 확장성
- **새 프로바이더 추가**: SDK 업데이트만으로 모든 앱에 적용 가능
- **UI 커스터마이징**: 향후 테마 설정, 로고 변경 등 확장 가능
- **멀티 앱 지원**: 동일한 SDK로 여러 앱에서 사용 가능

### 유지보수성
- **중앙 관리**: auth_sdk에서 로그인 화면을 통합 관리
- **버전 관리**: SDK 버전 업데이트로 일괄 적용
- **테스트 용이성**: Controller 로직을 단위 테스트 가능하도록 분리

### 사용자 경험
- **즉시 피드백**: 버튼 클릭 후 0.1초 내 로딩 상태 표시
- **명확한 안내**: 에러 메시지는 구체적이고 이해하기 쉽게 작성
- **일관성**: 모든 프로바이더에서 동일한 UX 패턴 유지
- **브랜드 준수**: 각 소셜 프로바이더의 브랜드 가이드라인 준수

---

## 스코프

### Phase 1 (현재 범위)
- [x] 로그인 화면 컴포넌트(View, Controller, Binding)를 auth_sdk로 이동
- [x] wowa 앱에서 SDK 로그인 화면 사용
- [x] 4개 소셜 프로바이더 로그인 (카카오, 네이버, 구글, 애플)
- [x] 로딩 상태 표시
- [x] 에러 처리 (네트워크, 계정 충돌, 사용자 취소)
- [x] 둘러보기 버튼
- [x] Frame0 스케치 스타일 디자인

### Phase 2 (향후)
- [ ] 계정 연동 기능 구현 (계정 충돌 모달의 "연동하기" 버튼)
- [ ] 로그인 화면 테마 커스터마이징 (색상, 로고, 타이틀)
- [ ] 다국어 지원 (영어, 일본어 등)
- [ ] 생체 인증 연동 (지문, Face ID)
- [ ] 이메일/비밀번호 로그인 추가
- [ ] 소셜 프로바이더 동적 활성화/비활성화 (앱별 설정)

### Out of Scope (Phase 1에서 제외)
- ❌ 회원가입 화면 (소셜 로그인으로 자동 가입)
- ❌ 비밀번호 찾기 기능
- ❌ 프로필 수정 기능
- ❌ 로그인 이력 조회
- ❌ 다중 계정 전환

---

## 참고 자료

- 모바일 카탈로그: `docs/wowa/mobile-catalog.md`
- 서버 카탈로그: `docs/wowa/server-catalog.md`
- 기존 로그인 구현: `apps/mobile/apps/wowa/lib/app/modules/login/`
- auth_sdk 패키지: `apps/mobile/packages/auth_sdk/`
- design_system 패키지: `apps/mobile/packages/design_system/`
- 소셜 로그인 상세 분석: `docs/core/social-login.md`
